---
title: 'block()'
description: 'Million.js introduit le concept de Bloc. Les Blocs sont une mani√®re de rendre les composants React en utilisant le DOM virtuel de Million.js.'
---

import { Callout, Tabs, Tab } from 'nextra-theme-docs';
import { AutomaticModeWarning } from '../../../components/automatic-mode-warning';

<AutomaticModeWarning />

# `block(){:jsx}`

**Syntaxe:** `block((props) => vnode){:jsx}`\
**Exemple:** `block((props) => <div>{props.foo}</div>){:jsx}`

Million.js est une biblioth√®que qui vous permet de cr√©er des _blocs_. Un bloc est un [composant d'ordre sup√©rieur (HOC)](https://legacy.reactjs.org/docs/higher-order-components.html) sp√©cial qui peut √™tre utilis√© comme un composant React, mais qui est hyper-optimis√© pour la vitesse de rendu.

Les blocs sont essentiellement des composants envelopp√©s par `block(){:jsx}`.

<Tabs items={['Javascript', 'Typescript',]} storageKey="selected-language">
  <Tab>
    ```jsx
    import { block } from 'million/react';

    const LionBlock = block(function Lion() {
      return <img src="https://million.dev/lion.svg" />;
    });

    export default LionBlock;
    ```

  </Tab>

  <Tab>
    <Callout type="info">
    Vous devez faire en sorte que vos Props utilisent `type` au lieu de `interface`, car c'est le [comportement officiellement reconnu](https://github.com/microsoft/TypeScript/issues/15300#issuecomment-332366024)
    par l'√©quipe TypeScript. Alternativement, si vous pr√©f√©rez utiliser des interfaces, vous pouvez ajouter `[key: string]: any` comme indiqu√© dans [ce commentaire sur Stack Overflow.](https://stackoverflow.com/questions/37006008/typescript-index-signature-is-missing-in-type/65473225#65473225).
    </Callout>

    ```jsx
    type Props = {
      name: string,
    };

    const Lion: React.FC<Props> = ({ name }) => {
      return (
        <div>Hello {name}</div>
        <img src="https://million.dev/lion.svg" />;
      )
    };
    const LionBlock = block(Lion);

    export default LionBlock;

    ```

  </Tab>
</Tabs>

## Balises personnalis√©es

La propri√©t√© `as` peut √™tre utilis√©e pour sp√©cifier le nom de la balise pour la directive `For`. Par d√©faut, c'est `slot`.

```jsx
import { block } from 'million/react';

const LionBlock = block(
  function Lion() {
    return <img src="https://million.dev/lion.svg" />;
  },
  { as: 'div' },
);
```

## Utilisation de bloc avec SSR

Si vous utilisez Million.js c√¥t√© serveur, vous pouvez rencontrer une erreur de d√©synchronisation de l'hydratation. Cela est d√ª au fait que Million.js utilise un algorithme diff√©rent pour le rendu c√¥t√© serveur par rapport au rendu c√¥t√© client. Pour r√©soudre ce probl√®me, vous pouvez d√©sactiver le SSR.

```jsx
const NoSSRBlock = block(
  function NoSSR() {
    return <div>{Math.random()}</div>;
  },
  { ssr: false },
);
```

## R√®gles des blocs

  <Callout type="warning">
    <code><strong>\[Million.js\]</strong> You did something wrong!</code>

    ```jsx showLineNumbers filename="App.jsx" {2}
    <div>
      <YourBlock>Uh oh...</YourBlock>
                ^
    </div>
    ```

  </Callout>

Il existe trois raisons courantes pour lesquelles vous pourriez le voir :

1. Enfreindre [les r√®gles des blocs](/docs/manual-mode/block#breaking-rules-of-blocks)
2. Ne pas [ajouter le compilateur](/docs/manual-mode/block#using-the-compiler)
3. Rencontrer [un comportement non pris en charge](/docs/manual-mode/block#unsupported-behavior)

## Enfreindre les r√®gles des blocs

Vous avez peut-√™tre entendu parler de ["l'am√©lioration progressive"](https://developer.mozilla.org/en-US/docs/Glossary/Progressive_Enhancement), qui est l'id√©e selon laquelle les outils utilisent progressivement des fonctionnalit√©s en fonction de ce qui est pris en charge. De mani√®re similaire, Million.js a la "d√©gradation progressive" ou le concept selon lequel, si vous utilisez des fonctionnalit√©s qui ne sont pas prises en charge, elle se d√©gradera √©l√©gamment vers le rendu React par d√©faut.

Cette section met en √©vidence certains des avertissements possibles que vous pourriez rencontrer en utilisant des blocs. Notez que cette liste n'est pas exhaustive.

{' '}

<Callout type="info">
  Cette section pr√©sente des motifs idiomatiques pour utiliser les blocs. Ce
  n'est pas une liste d'erreurs, votre application fonctionnera toujours si vous
  ne suivez pas ces motifs.
</Callout>

### D√©claration des blocs

{' '}

<Callout type="warning">
  <code>
    <strong>[Million.js]</strong> Block needs to be defined as a variable
    declaration.
  </code>
</Callout>

Ce probl√®me survient g√©n√©ralement lorsque vous avez un bloc qui n'est pas d√©clar√© en tant que variable. Cela emp√™che le compilateur d'analyser correctement le bloc.

```jsx
console.log(block(() => <div />)) // ‚ùå Wrong
export default block(() => <div />) // ‚ùå Wrong

// üëáüëáüëá

const Block = block(() => <div />) // ‚úÖ Correct
console.log(Block);
export default Block;
```

### Appel `block()`

{' '}

<Callout type="warning">
  <code>
    <strong>[Million.js]</strong> Found unsupported argument for block. Make
    sure blocks consume a reference to a component function or the direct
    declaration.
  </code>
</Callout>

Cela se produit g√©n√©ralement lorsque vous avez un composant JSX r√©el comme `<Component />{:jsx}` pass√© dans la fonction `block(){:jsx}` au lieu d'une r√©f√©rence au composant lui-m√™me.

```jsx
const BadBlock = block(<Component />); // ‚ùå Wrong

const GoodBlock = block(App); // ‚úÖ Correct
```

### Utiliser `<For />` au lieu de `map()`

{' '}

<Callout type="warning">
  <code>
    <strong>[Million.js]</strong>
    Array.map() will degrade performance. We recommend removing the block on the
    current component and using a `<For />` component instead
  </code>
</Callout>

Cela se produira lorsque vous utilisez `<Array>.map` √† l'int√©rieur d'un bloc. Ce n'est pas id√©al, surtout si le composant qui contient la liste est un bloc. Le bon motif est de supprimer le bloc sur le composant actuel et d'utiliser plut√¥t un composant `<For />` pour les enfants.

```jsx
<div>
  {items.map((item) => (
    <div key={item}>{item}</div>
  ))}
</div>

// üëáüëáüëá

<For each={items}>
  {(item) => <div key={item}>{item}</div>}
</For>
```

### Retours d√©terministes

  <div className="flex gap-3">
  <Callout type="warning">
    <code>
    <strong>[Million.js]</strong>
    Conditional expressions will degrade performance. We recommend using
    deterministic returns instead.
    </code>
  </Callout>

  <Callout type="error">
    <code>
    Uncaught Error: Rendered fewer hooks than expected. This may be caused by an accidental early return statement.
    </code>
  </Callout>
  </div>

Les retours doivent √™tre "d√©terministes", ce qui signifie qu'il ne peut y avoir qu'une seule instruction de retour √† la fin du bloc qui renvoie un arbre stable.

Quelques exemples de retours non d√©terministes:

```jsx
function Component() {
  const [count, setCount] = useState(initial.count);

  if (count > 10) {
    return <div>Too many clicks!</div>; // ‚ùå Wrong
  }

  // ‚ùå Wrong
  return count > 5 ? 'Count is greater than 5' : <div>Count is {count}.</div>;
}

const ComponentBlock = block(Component);
```

### Biblioth√®ques de composants d'interface utilisateur üôÖ‚Äç‚ôÄÔ∏è

{' '}

<Callout type="warning">
  <code>
    <strong>[Million.js]</strong>
    Components will cause degraded performance. Ideally, you should use DOM elements
    instead.
  </code>
</Callout>

De nombreuses applications React utilisent des biblioth√®ques de composants d'interface utilisateur telles que Material UI, Chakra UI ou Tailwind UI. Ces biblioth√®ques sont excellentes, mais elles ne sont pas optimis√©es pour Million.js.

Million.js exige que vous utilisiez des √©l√©ments DOM plut√¥t que des composants. Cela est d√ª au fait que les composants peuvent introduire des retours non d√©terministes, ce qui peut entra√Æner une d√©gradation des performances.

```jsx
// ‚ùå Bad
<Stack>
  <Text>What's up my fellow components</Text>
</Stack>

// ü§® Maybe
<div>
  <Text>What's up my fellow components</Text>
</div>

// ‚úÖ Good
<div>
  <p>What's up my fellow components</p>
</div>
```

### Propagation d'attributs/enfants

{' '}

<Callout type="warning">
  <code>
    <strong>[Million.js]</strong>
    Spread attributes/children are not fully supported
  </code>
</Callout>

Vous ne pouvez pas utiliser en toute s√©curit√© la propagation d'attributs/enfants qui changent ou font r√©f√©rence √† une liaison √† l'int√©rieur du composant dans Million.js, car cela peut introduire des retours non d√©terministes.

```jsx
const arr = ['Hello'];

<div>{...arr}</div>; // Ok if arr never changes

// ‚ùå Bad
arr.push('World');
```

### Importation non prise en charge

{' '}

<Callout type="error">
  <code>
    <strong>[Million.js]</strong>
    Found unsupported import for block. Make sure blocks are imported from million/react.
  </code>
</Callout>

Cela peut √™tre caus√© par l'importation du bloc depuis le mauvais emplacement. Assurez-vous d'importer le bloc depuis `million/react` plut√¥t que `million`.

```jsx
import { block } from 'million'; // ‚ùå Wrong

import { block } from 'million/react'; // ‚úÖ Correct
```

### Utilisation du compilateur

{' '}

<Callout type="error">
  <code>
    <strong>Warning: </strong>
    Invalid Hook Call. Hooks can only be called inside of the body of a function
    component.
  </code>
</Callout>

Vous avez peut-√™tre oubli√© d'utiliser le compilateur, une partie n√©cessaire pour garantir que votre JSX est compil√© en code compatible avec Million.js. Vous pouvez consulter les instructions dans [le guide d'installation](/docs/getting-started/install).

En passant, Million.js est techniquement utilisable sans le compilateur, mais cela limite consid√©rablement sa port√©e, et il existe un ensemble plus restreint de fonctionnalit√©s disponibles. Cela n'est pas recommand√©.

### Comportement non pris en charge

{' '}

<Callout type="error">
  <code>Uncaught Error: ??? :(</code>
</Callout>

Si aucune de ces solutions n'a fonctionn√©, veuillez [cr√©er un issue](https://github.com/aidenybai/million/issues/new?assignees=aidenybai&labels=bug&projects=&template=bug_report.md&title=bug%3A+), et nous essaierons de vous aider. Essayez de cr√©er un petit exemple reproductible ‚Äî vous pourriez d√©couvrir le probl√®me pendant le processus.
